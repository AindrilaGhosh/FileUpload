kind: ServiceBundle
labels:
  tier: application
  team: maglev-system
  maglev.system.io/prometheus/scrape: true
  maglev.system.io/prometheus/port: default
  maglev.system.io/prometheus/path: /api/services/licenseservice/metrics
annotations:
 maglev.system.io/service-discovery-managed: mongodb, rabbitmq
 maglev.system.io/service-discovery-unmanaged: authz:http:maglev-ingress
manifestVersion: v12
name: licenseservice 
version: 1.0.0
appstack: maglev-system
appstackVersion: 1.0.0
spec:
  apps:
    licenseservice: 
      runtime: python
      runtimeVersion: 3.5.2
      framework: maglev_service
      frameworkVersion:  1.0.0
      artifact: file://licenseservice.tar.gz
      version: 1.0.0
      environment:
        BYPASS_SECURITY: true
        USE_INSTANCE_ROLE: true
        DEBUG: 1
        SERVICE_VERSION: 1.0.0
        DISABLE_EVENTBUS: True
        DISABLE_AUTH: True
        TOPOLOGY_VERSION: v2
        MANAGED_MONGO_STORE: maglev-system
        IS_CLUSTER_ENV: true
        IS_CLOUD_ENV: true
        imagePullPolicy: Always
        CONTEXT_PATH: /api/maglev-system/v1/license
      resources:
          limits:
              cpu: 100
              memory: 1024
          requests:
              cpu: 100
              memory: 256
      health:
        liveness:
            name: service_liveness_check
            type: get
            uri: /api/services/licenseservice/status
            delay: 300
            timeout: 60
            port: 8012
            failureThreshold: 30
            periodSeconds: 300
        readiness:
            name: service_readiness_check
            type: get
            uri: /api/services/licenseservice/status
            delay: 0
            timeout: 60
            port: 8012
            failureThreshold: 30
            periodSeconds: 30
  nodeType: web
  provides:
    ports:
    - name: default
      port: 8012
      protocol: TCP
    resources:
    - name: license-service-policy
      type: all resources
      label: License service default Policy
      operations:
        - name: gRead
          label: View default
        - name: gUpdate
          label: Modify default
        - name: gCreate
          label: Create default
        - name: gRemove
          label: Delete default
    defaultPermissionMappings:
    - permissionName: superadmin-manage-license-svc
      rbacResource: license-service-policy
      operations: gCreate,gRead,gUpdate,gRemove
      permissionGroup: NETWORK-ADMIN-PERMISSION-GROUP,OBSERVER-PERMISSION-GROUP,SUPER-ADMIN-PERMISSION-GROUP,TETHERING-ADMIN-PERMISSION-GROUP
    - permissionName: accountuser-manage-license-svc
      rbacResource: license-service-policy
      operations: gCreate,gRead,gUpdate,gRemove
      permissionGroup: NETWORK-ADMIN-PERMISSION-GROUP,OBSERVER-PERMISSION-GROUP,SUPER-ADMIN-PERMISSION-GROUP,TETHERING-ADMIN-PERMISSION-GROUP
    services:
    - apiUrlPath: /api/maglev-system/v1/license
      port: $default
      rbacMappings:
      - resourceURL: /
        rbacResource: license-service-policy
      stripPath: false
      disablePrefix: true
      secure: false
  scaling:
    limits:
      min: 1
